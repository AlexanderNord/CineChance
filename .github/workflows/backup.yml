name: Test Yandex Disk

on:
  workflow_dispatch

jobs:
  test-yandex-disk:
    runs-on: ubuntu-latest

    steps:
      - name: Install rclone
        run: curl -fsSL https://rclone.org/install.sh | sudo bash

      - name: Configure rclone for Yandex Disk
        run: |
          mkdir -p ~/.config/rclone
          cat > ~/.config/rclone/rclone.conf << EOF
          [yandex]
          type = webdav
          url = https://webdav.yandex.ru
          vendor = other
          user = oauth
          pass = ${{ secrets.YANDEX_DISK_TOKEN }}
          EOF

      - name: Create folder on Yandex Disk
        run: rclone mkdir yandex:/CineChanceTest

      - name: Create test file
        run: |
          echo "Test backup from GitHub Actions - $(date)" > test_file.txt
          echo "Filename: test_file.txt" >> test_file.txt
          echo "Timestamp: $(date +%Y%m%d_%H%M%S)" >> test_file.txt

      - name: Upload test file to Yandex Disk
        run: rclone copy test_file.txt yandex:/CineChanceTest/ --verbose

      - name: Verify upload
        run: rclone ls yandex:/CineChanceTest/

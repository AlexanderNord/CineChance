# Архитектура проекта CineChance

## Обзор архитектуры

CineChance построен на современной архитектуре Next.js 16 с App Router, которая обеспечивает оптимальную производительность и разработку.

## Технологический стек

### Frontend
- **Next.js 16 (App Router)** - современный фреймворк с Server Components
- **React 19** - последняя версия React с улучшенной производительностью
- **TypeScript** - строгая типизация для надежности кода
- **TailwindCSS** - utility-first CSS фреймворк
- **React Query (@tanstack/react-query)** - управление состоянием сервера
- **Lucide React** - библиотека иконок

### Backend
- **Next.js API Routes** - серверные эндпоинты
- **Prisma ORM 7.2** - работа с базой данных
- **PostgreSQL (Neon)** - serverless база данных
- **NextAuth.js 4.24** - аутентификация и авторизация
- **Upstash Redis** - rate limiting и кэширование

### Внешние сервисы
- **TMDB API** - база данных фильмов и сериалов
- **Neon Database** - хостинг PostgreSQL
- **Vercel** - хостинг и деплой

## Структура приложения

```
src/
├── app/                    # Next.js App Router
│   ├── api/               # API Routes
│   ├── components/        # Реиспользуемые компоненты
│   ├── [feature]/         # Динамические маршруты
│   ├── layout.tsx         # Root layout
│   └── page.tsx           # Главная страница
├── lib/                   # Утилиты и конфигурации
│   ├── prisma.ts         # Prisma клиент
│   ├── tmdb.ts           # TMDB API обертки
│   └── movieStatus.ts    # Логика статусов
├── auth.ts               # NextAuth конфигурация
├── middleware/           # Middleware функции
└── hooks/               # React хуки
```

## Ключевые принципы архитектуры

### 1. Server Components по умолчанию
- Большинство компонентов - Server Components
- Максимальная производительность за счет серверного рендеринга
- Клиентские компоненты только для интерактивности

### 2. Единый источник данных
- Prisma singleton в `src/lib/prisma.ts`
- Централизованная работа с базой данных
- Оптимизированные подключения к Neon

### 3. Безопасность
- Rate limiting на всех API эндпоинтах
- Валидация сессий через NextAuth
- Age-gating для контента 18+

### 4. Производительность
- ISR кэширование для TMDB запросов
- Оптимизированные запросы к БД
- Ленивая загрузка компонентов

## Потоки данных

### Аутентификация
```
Пользователь → NextAuth → JWT → Server Components/API Routes
```

### Рекомендации
```
Пользователь → ML алгоритм → RecommendationLog → UI
```

### Поиск фильмов
```
UI → API Route → TMDB → ISR Cache → UI
```

## Масштабируемость

### Горизонтальная масштабируемость
- Serverless архитектура на Vercel
- Автоматическое масштабирование Next.js
- Neon PostgreSQL автоматическое масштабирование

### Вертикальная масштабируемость
- Модульная архитектура компонентов
- Переиспользуемые утилиты в `src/lib/`
- Чистое разделение Frontend/Backend

## Безопасность

### Защита данных
- Хеширование паролей bcryptjs
- JWT токены с ограниченным сроком действия
- Валидация всех входных данных

### Rate Limiting
- Upstash Redis для ограничения запросов
- Индивидуальные лимиты на каждый эндпоинт
- Защита от DDoS атак

### Age Gates
- Фильтрация контента 18+ по дате рождения
- Отдельные логики для разных возрастных групп

## Мониторинг и аналитика

### Система рекомендаций
- Детальное логирование всех взаимодействий
- A/B тестирование алгоритмов
- Метрики производительности рекомендаций

### Пользовательская аналитика
- История просмотров и оценок
- Поведенческие паттерны
- Статистика использования

## Будущее развитие

### Планируемые улучшения
- Расширение ML алгоритмов
- Мобильное приложение
- Социальные функции
- Расширенная аналитика

### Технический долг
- Миграция на новые версии зависимостей
- Оптимизация запросов к БД
- Улучшение UI/UX

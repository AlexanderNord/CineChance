<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö ID —Å—Ç–∞—Ç—É—Å–æ–≤</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-950 text-white p-4">
    <div class="max-w-6xl mx-auto space-y-4">
        <h1 class="text-2xl font-bold">üîç –†–µ–∞–ª—å–Ω—ã–µ ID —Å—Ç–∞—Ç—É—Å–æ–≤ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö</h1>
        
        <div id="loading" class="text-gray-400">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
        
        <div id="results" class="space-y-4 hidden">
            <!-- –†–µ–∞–ª—å–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã –∏–∑ –±–∞–∑—ã -->
            <div class="bg-gray-900 p-4 rounded-lg">
                <h2 class="text-lg font-semibold mb-3 text-blue-400">üìã –†–µ–∞–ª—å–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã –≤ –±–∞–∑–µ</h2>
                <div id="realStatuses" class="space-y-2"></div>
            </div>
            
            <!-- –°—á–µ—Ç—á–∏–∫–∏ –ø–æ –∫–∞–∂–¥–æ–º—É —Å—Ç–∞—Ç—É—Å—É -->
            <div class="bg-gray-900 p-4 rounded-lg">
                <h2 class="text-lg font-semibold mb-3 text-green-400">üî¢ –°—á–µ—Ç—á–∏–∫–∏ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º</h2>
                <div id="counts" class="space-y-2"></div>
            </div>
            
            <!-- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞–º–∏ -->
            <div class="bg-gray-900 p-4 rounded-lg">
                <h2 class="text-lg font-semibold mb-3 text-yellow-400">‚öñÔ∏è –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞–º–∏</h2>
                <div id="comparison" class="space-y-2"></div>
            </div>
            
            <!-- –û–±—Ä–∞–∑—Ü—ã –∑–∞–ø–∏—Å–µ–π -->
            <div class="bg-gray-900 p-4 rounded-lg">
                <h2 class="text-lg font-semibold mb-3 text-purple-400">üìù –û–±—Ä–∞–∑—Ü—ã –∑–∞–ø–∏—Å–µ–π</h2>
                <div id="sampleRecords" class="space-y-3"></div>
            </div>
            
            <!-- –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="bg-gray-900 p-4 rounded-lg">
                <h2 class="text-lg font-semibold mb-3 text-red-400">üìä –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                <div id="summary" class="space-y-2"></div>
            </div>
        </div>
        
        <div class="flex gap-4">
            <button onclick="location.reload()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">
                üîÑ –û–±–Ω–æ–≤–∏—Ç—å
            </button>
            <button onclick="window.open('/test-logs-browser.html', '_blank')" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded">
                üìã –õ–æ–≥–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            </button>
        </div>
    </div>

    <script>
        let realData = null;

        // –¢–µ–∫—É—â–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã (–¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å movieStatusConstants.ts)
        const CURRENT_CONSTANTS = {
            WANT_TO_WATCH: 1,
            WATCHED: 2,
            DROPPED: 3,
            REWATCHED: 7
        };

        async function fetchRealStatuses() {
            try {
                document.getElementById('loading').classList.remove('hidden');
                document.getElementById('results').classList.add('hidden');
                
                const response = await fetch('/api/debug/real-status-ids');
                realData = await response.json();
                
                console.log('–†–µ–∞–ª—å–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã:', realData);
                
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('results').classList.remove('hidden');
                
                displayRealStatuses();
                displayCounts();
                displayComparison();
                displaySampleRecords();
                displaySummary();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                document.getElementById('loading').innerHTML = `<div class="text-red-400">–û—à–∏–±–∫–∞: ${error.message}</div>`;
            }
        }
        
        function displayRealStatuses() {
            const realStatuses = document.getElementById('realStatuses');
            const statuses = realData.realStatuses;
            
            realStatuses.innerHTML = statuses.map(status => `
                <div class="flex justify-between items-center p-2 bg-gray-800 rounded">
                    <span class="font-semibold">${status.name}</span>
                    <span class="text-blue-400">ID: ${status.id}</span>
                </div>
            `).join('');
        }
        
        function displayCounts() {
            const counts = document.getElementById('counts');
            const statusCounts = realData.counts;
            
            counts.innerHTML = statusCounts.map(item => `
                <div class="flex justify-between items-center p-2 bg-gray-800 rounded">
                    <span>${item.name} (ID: ${item.id})</span>
                    <span class="text-green-400 font-bold">${item.count} –∑–∞–ø–∏—Å–µ–π</span>
                </div>
            `).join('');
        }
        
        function displayComparison() {
            const comparison = document.getElementById('comparison');
            const statuses = realData.realStatuses;
            
            let html = '<div class="space-y-2">';
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç
            const statusMap = {
                '–•–æ—á—É –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å': 'WANT_TO_WATCH',
                '–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ': 'WATCHED',
                '–ë—Ä–æ—à–µ–Ω–æ': 'DROPPED',
                '–ü–µ—Ä–µ—Å–º–æ—Ç—Ä–µ–Ω–æ': 'REWATCHED'
            };
            
            statuses.forEach(status => {
                const constantName = statusMap[status.name];
                const constantId = CURRENT_CONSTANTS[constantName];
                const isMatch = constantId === status.id;
                
                html += `
                    <div class="flex justify-between items-center p-2 bg-gray-800 rounded">
                        <span>${status.name}</span>
                        <div class="flex items-center gap-4">
                            <span class="text-xs">–ë–∞–∑–∞ ID: ${status.id}</span>
                            <span class="text-xs">–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞: ${constantId}</span>
                            <span class="${isMatch ? 'text-green-400' : 'text-red-400'}">${isMatch ? '‚úÖ' : '‚ùå'}</span>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            comparison.innerHTML = html;
        }
        
        function displaySampleRecords() {
            const sampleRecords = document.getElementById('sampleRecords');
            const records = realData.sampleRecords;
            
            let html = '';
            records.forEach(statusGroup => {
                html += `
                    <div class="mb-3">
                        <h3 class="font-semibold text-sm mb-2">${statusGroup.statusName} (ID: ${statusGroup.statusId}) - ${statusGroup.records.length} –∑–∞–ø–∏—Å–µ–π:</h3>
                        <div class="space-y-1">
                            ${statusGroup.records.map(record => `
                                <div class="text-xs p-2 bg-gray-800 rounded">
                                    <div class="font-semibold">${record.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</div>
                                    <div class="text-gray-400">
                                        ID: ${record.tmdbId} | –¢–∏–ø: ${record.mediaType} | –î–æ–±–∞–≤–ª–µ–Ω–æ: ${new Date(record.addedAt).toLocaleString()}
                                    </div>
                                </div>
                            `).join('')}
                            ${statusGroup.records.length === 0 ? '<div class="text-xs text-gray-500">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</div>' : ''}
                        </div>
                    </div>
                `;
            });
            
            sampleRecords.innerHTML = html;
        }
        
        function displaySummary() {
            const summary = document.getElementById('summary');
            const counts = realData.counts;
            
            // –°—á–∏—Ç–∞–µ–º –∏—Ç–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
            const watchedCount = counts.find(c => c.name === '–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ')?.count || 0;
            const rewatchedCount = counts.find(c => c.name === '–ü–µ—Ä–µ—Å–º–æ—Ç—Ä–µ–Ω–æ')?.count || 0;
            const wantToWatchCount = counts.find(c => c.name === '–•–æ—á—É –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å')?.count || 0;
            const droppedCount = counts.find(c => c.name === '–ë—Ä–æ—à–µ–Ω–æ')?.count || 0;
            const hiddenCount = realData.blacklistCount;
            
            const totalWatched = watchedCount + rewatchedCount;
            const totalActive = totalWatched + wantToWatchCount + droppedCount;
            
            summary.innerHTML = `
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    <div class="text-center p-3 bg-gray-800 rounded">
                        <div class="text-2xl font-bold text-green-400">${totalWatched}</div>
                        <div class="text-sm text-gray-400">–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ –≤—Å–µ–≥–æ</div>
                        <div class="text-xs text-gray-500">(${watchedCount} + ${rewatchedCount})</div>
                    </div>
                    <div class="text-center p-3 bg-gray-800 rounded">
                        <div class="text-2xl font-bold text-blue-400">${wantToWatchCount}</div>
                        <div class="text-sm text-gray-400">–û—Ç–ª–æ–∂–µ–Ω–æ</div>
                    </div>
                    <div class="text-center p-3 bg-gray-800 rounded">
                        <div class="text-2xl font-bold text-red-400">${droppedCount}</div>
                        <div class="text-sm text-gray-400">–ë—Ä–æ—à–µ–Ω–æ</div>
                    </div>
                    <div class="text-center p-3 bg-gray-800 rounded">
                        <div class="text-2xl font-bold text-gray-400">${hiddenCount}</div>
                        <div class="text-sm text-gray-400">–°–∫—Ä—ã—Ç–æ</div>
                    </div>
                    <div class="text-center p-3 bg-gray-800 rounded">
                        <div class="text-2xl font-bold text-purple-400">${totalActive}</div>
                        <div class="text-sm text-gray-400">–ê–∫—Ç–∏–≤–Ω—ã—Ö –≤—Å–µ–≥–æ</div>
                    </div>
                </div>
            `;
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
        fetchRealStatuses();
    </script>
</body>
</html>
